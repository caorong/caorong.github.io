<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>jdbc 好坑啊 | lelouchcr&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/app.css">
  <!-- <link rel='stylesheet' href='http://fonts.useso.com/css?family=Source+Code+Pro'> -->
</head>

<body>
  <nav class="app-nav">
  
    
      <a href="/.">home</a>
    
  
    
      <a href="/archives">archive</a>
    
  
    
      <a href="/atom.xml">rss</a>
    
  
</nav>

  <main class="post">
  <article>
  <h1 class="article-title">
    <a href="/2014/12/09/about-jdbc/">jdbc 好坑啊</a>
  </h1>

  <section class="article-meta">
    <p class="article-date">December 09 2014</p>
  </section>

  <section class="article-entry">
    <p>最近在写一个自己的项目，底层db 想用dbutils + c3p0 顺便研究下底层的代码，结果立马跌坑里了。</p>
<h3 id="GET-GENERATED-KEY"><a href="#GET-GENERATED-KEY" class="headerlink" title="GET GENERATED_KEY"></a>GET GENERATED_KEY</h3><p>mysql 的<code>主键</code>如果选择 autogenrated 的话，那么会自动生成id。如果想到获得这个 id 的话在 12 年的dbutils是不支持的，除非你再查一次或者修改源码比如这个<a href="https://issues.apache.org/jira/browse/DBUTILS-54" target="_blank" rel="external">patch</a>。</p>
<p>不过今年出了个 1.6 版本，（撇开下话题，话说我 google 的是否发现连<a href="https://www.google.com.hk/search?newwindow=1&amp;safe=strict&amp;es_sm=91&amp;q=dbutils+%E7%9C%8B%E7%9C%8B%E6%96%B0%E9%97%BB&amp;oq=dbutils+%E7%9C%8B%E7%9C%8B%E6%96%B0%E9%97%BB&amp;gs_l=serp.3...994.7562.0.7649.24.16.3.0.0.2.532.2771.2-2j5j0j1.8.0.msedr...0...1c.1j4.59.serp..22.2.384.ROWHlUPFwEM" target="_blank" rel="external">“看看新闻网”</a>都报道了这个消息），他多了个<code>insert</code>接口，代码入下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span><br><span class="line">     * Executes the given INSERT SQL without any replacement parameters.</span><br><span class="line">     * The &lt;code&gt;Connection&lt;/code&gt; is retrieved from the</span><br><span class="line">     * &lt;code&gt;DataSource&lt;/code&gt; set in the constructor.</span><br><span class="line">     * <span class="doctag">@param</span> &lt;T&gt; The type of object that the handler returns</span><br><span class="line">     * <span class="doctag">@param</span> sql The SQL statement to execute.</span><br><span class="line">     * <span class="doctag">@param</span> rsh The handler used to create the result object from</span><br><span class="line">     * the &lt;code&gt;ResultSet&lt;/code&gt; of auto-generated keys.</span><br><span class="line">     * <span class="doctag">@return</span> An object generated by the handler.</span><br><span class="line">     * <span class="doctag">@throws</span> SQLException if a database access error occurs</span><br><span class="line">     * <span class="doctag">@since</span> 1.6</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">insert</span><span class="params">(String sql, ResultSetHandler&lt;T&gt; rsh)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> insert(<span class="keyword">this</span>.prepareConnection(), <span class="keyword">true</span>, sql, rsh, (Object[]) <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 内部实现</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">            stmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);</span><br><span class="line">            <span class="keyword">this</span>.fillStatement(stmt, params);</span><br><span class="line">            stmt.executeUpdate();</span><br><span class="line">            ResultSet resultSet = stmt.getGeneratedKeys();</span><br><span class="line">            generatedKeys = rsh.handle(resultSet);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">this</span>.rethrow(e, sql, params);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            close(stmt);</span><br><span class="line">            <span class="keyword">if</span> (closeConn) &#123;</span><br><span class="line">                close(conn);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> generatedKeys;</span><br></pre></td></tr></table></figure>
<p>如果是插入语句的话自己实现一个回调函数，他会帮你拿generated key，然后调用你然后层层返回generatedKey。</p>
<p>然后就坑了。。。。</p>
<p>好久没写jdbc了，我忘记拿 resultSet 之前要先 resultSet.next()下了(而且即使是第一条数据也是必须要先next下的)。。。。各种debug看数据明明是有的。。。</p>
<p>于是研究了下代码，next到底干了啥事。。。</p>
<p>c3p0 也挺坑的。com.mchange.v2.c3p0.impl.NewProxyResultSet 这个class是生成的。源码是没的。。。</p>
<p>反编译结果，跟踪next()，于是定位刀inner</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">next</span><span class="params">()</span> <span class="keyword">throws</span> SQLException</span><br><span class="line">  </span>&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.proxyConn != <span class="keyword">null</span>) <span class="keyword">this</span>.proxyConn.maybeDirtyTransaction();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.inner.next();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (NullPointerException exc)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (isDetached())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">throw</span> SqlUtils.toSQLException(<span class="string">"You can't operate on a closed ResultSet!!!"</span>, exc);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">throw</span> exc;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception exc)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (!isDetached())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">this</span>.parentPooledConnection.handleThrowable(exc);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">throw</span> SqlUtils.toSQLException(exc);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>跟踪inner，这个是mysql-connector =&gt; ResultSetImpl.class 实现的。。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NewProxyResultSet</span><span class="params">(ResultSet inner)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.inner = inner;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续跟踪 mysql-connector =&gt; ResultSetImpl.class =&gt; inner </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">next</span><span class="params">()</span></span><br><span class="line">    <span class="keyword">throws</span> SQLException</span><br><span class="line">  </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (checkClosed().getConnectionMutex())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.onInsertRow) &#123;</span><br><span class="line">        <span class="keyword">this</span>.onInsertRow = <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.doingUpdates) &#123;</span><br><span class="line">        <span class="keyword">this</span>.doingUpdates = <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!reallyResult()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> SQLError.createSQLException(Messages.getString(<span class="string">"ResultSet.ResultSet_is_from_UPDATE._No_Data_115"</span>), <span class="string">"S1000"</span>, getExceptionInterceptor());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.thisRow != <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">this</span>.thisRow.closeOpenStreams();</span><br><span class="line">      <span class="keyword">boolean</span> b;</span><br><span class="line">      <span class="keyword">boolean</span> b;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.rowData.size() == <span class="number">0</span>) &#123;</span><br><span class="line">        b = <span class="keyword">false</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      	<span class="comment">// 这里</span></span><br><span class="line">        <span class="keyword">this</span>.thisRow = <span class="keyword">this</span>.rowData.next();</span><br><span class="line">        <span class="keyword">boolean</span> b;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.thisRow == <span class="keyword">null</span>) &#123;</span><br><span class="line">          b = <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          clearWarnings();</span><br><span class="line"></span><br><span class="line">          b = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      setRowPositionValidity();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>总之，吧 thisRow 作为那一条数据的指针了。</p>
<p>还有个问题，按照正常人的理解，第一条数据为何要next呢？</p>
<p>那么还要看下 rowdata 的结构</p>
<p>RowDataCursor.class  注意<code>currentPositionInEntireResult</code>这个变量, 初始值是－1 也是醉了。。。 next下后就变成0了。</p>
<p>然后，就可以取到 Field[0]了。。。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RowDataCursor</span></span><br><span class="line">  <span class="keyword">implements</span> <span class="title">RowData</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BEFORE_START_OF_ROWS = -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">private</span> List&lt;ResultSetRow&gt; fetchedRows;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> currentPositionInEntireResult = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> currentPositionInFetchedRows = -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">private</span> ResultSetImpl owner;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> lastRowFetched = <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">private</span> Field[] metadata;</span><br><span class="line">  <span class="keyword">private</span> MysqlIO mysql;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> statementIdOnServer;</span><br><span class="line">  <span class="keyword">private</span> ServerPreparedStatement prepStmt;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SERVER_STATUS_LAST_ROW_SENT = <span class="number">128</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> firstFetchCompleted = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> wasEmpty = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> useBufferRowExplicit = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">RowDataCursor</span><span class="params">(MysqlIO ioChannel, ServerPreparedStatement creatingStatement, Field[] metadata)</span></span><br><span class="line">  </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.currentPositionInEntireResult = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>.metadata = metadata;</span><br><span class="line">    <span class="keyword">this</span>.mysql = ioChannel;</span><br><span class="line">    <span class="keyword">this</span>.statementIdOnServer = creatingStatement.getServerStatementId();</span><br><span class="line">    <span class="keyword">this</span>.prepStmt = creatingStatement;</span><br><span class="line">    <span class="keyword">this</span>.useBufferRowExplicit = MysqlIO.useBufferRowExplicit(<span class="keyword">this</span>.metadata);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResultSetRow <span class="title">next</span><span class="params">()</span></span><br><span class="line">    <span class="keyword">throws</span> SQLException</span><br><span class="line">  </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">this</span>.fetchedRows == <span class="keyword">null</span>) &amp;&amp; (<span class="keyword">this</span>.currentPositionInEntireResult != -<span class="number">1</span>)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> SQLError.createSQLException(Messages.getString(<span class="string">"ResultSet.Operation_not_allowed_after_ResultSet_closed_144"</span>), <span class="string">"S1000"</span>, <span class="keyword">this</span>.mysql.getExceptionInterceptor());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!hasNext()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.currentPositionInEntireResult += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>.currentPositionInFetchedRows += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">this</span>.fetchedRows != <span class="keyword">null</span>) &amp;&amp; (<span class="keyword">this</span>.fetchedRows.size() == <span class="number">0</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.currentPositionInFetchedRows &gt; <span class="keyword">this</span>.fetchedRows.size() - <span class="number">1</span>) &#123;</span><br><span class="line">      fetchMoreRows();</span><br><span class="line">      <span class="keyword">this</span>.currentPositionInFetchedRows = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ResultSetRow row = (ResultSetRow)<span class="keyword">this</span>.fetchedRows.get(<span class="keyword">this</span>.currentPositionInFetchedRows);</span><br><span class="line"></span><br><span class="line">    row.setMetadata(<span class="keyword">this</span>.metadata);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> row;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>最后就串起来了，总之他这么坑人的设计其实是为了防止查询到不存在的数据 ，防止 Filed 数组越界，特别是如果 query 出来0个结果然后不 next 检查顺便定位下，而是直接 getObject(0) 然后数组就越界了。。。</p>

  </section>
</article>

  <div class="sharing grid">
  <section class="profile grid-item grid">
    <img class="avatar" src="https://gravatar.css.network/avatar/f6adb1529491a56dbe31c57d519585f5?s=400&r=g" alt="avatar" />
    <div class="grid-item">
      <p class="title"> lelouchcr's blog </p>
      <p class="subtitle">  </p>
    <div>
  </section>

  <section class="share-btns">
    <!-- <p> share it if you like it~ </p> -->
    <a
  class="twitter-share-button"
  data-size="large"
  data-via="DrakeLeung"
  href="https://twitter.com/intent/tweet?text=最近在写一个自己的项目，底层db 想用d"
>
  Tweet
</a>

<script>
  window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  js.async = true;
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
</script>

  </section>
</div>


  
    
<section class="article-comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

<script>
  var disqus_shortname = 'caorong';
  
  var disqus_url = 'http://caorong.github.io/2014/12/09/about-jdbc/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  
  

<script>
    setTimeout(function() {
            var hjs = document.createElement('script');
            hjs.setAttribute('src', 'https://www.acgart.download/rand?ratio=0.625&range=0.2&source=pixiv&encode=jsc&func=lgallery');
            document.body.appendChild(hjs);
        }, 0);

    function lgallery(option) {
            console.log(option);
            var bgimg = document.createElement('img');
            bgimg.setAttribute('src', option.p_ori);
            bgimg.setAttribute('id', 'bkImg');
            bgimg.setAttribute('onmousedown', 'return false');
            document.body.appendChild(bgimg);
        }

</script>

</main>

</body>
</html>
